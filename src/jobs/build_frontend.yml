description: |
  Build the front-end.

  The following npm commands are required and will be called:
   - npm run lint
   - npm run build

parameters:
  executor:
    type: executor
    description: The executor to use.
  storybook_path:
    description: The Storybook build path.
    type: string
  library_path:
    description: The Drupal library path.
    type: string
    default: ""
  init:
    type: steps
    description: Initialise the front-end dependencies.
    default:
      - run:
          name: Install
          command: npm -q ci
  lint:
    type: steps
    description: Check the codebase against style guidelines.
    default:
      - run:
          name: Lint
          command: npm run lint
  build:
    type: steps
    description: Build the front-end components.
    default:
      - run:
          name: Build
          command: npm run build
  cache-version:
    description: An optional version number for cache dependencies, e.g. v1
    type: string
    default: v2

executor: <<parameters.executor>>

steps:
  - checkout
  - restore_cache:
      keys:
        - deps-node-<<parameters.cache-version>>-{{ arch }}-{{ checksum "package-lock.json" }}
  - steps: <<parameters.init>>
  - save_cache:
      key: deps-node-<<parameters.cache-version>>-{{ arch }}-{{ checksum "package-lock.json" }}
      paths:
        - ~/.npm
  - steps: <<parameters.lint>>
  - steps: <<parameters.build>>
  - persist_to_workspace:
      root: /data
      paths:
        - <<parameters.storybook_path>>
        - <<parameters.library_path>>
        - node_modules

description: >
  Automated patching.

parameters:
  executor:
    type: executor
    description: The executor to use.
  ssh_fingerprint:
    description: The SSH fingerprint used for writing back to the project repo.
    type: string

executor: <<parameters.executor>>

steps:
  - add_ssh_keys:
      fingerprints:
        - <<parameters.ssh_fingerprint>>
  - checkout
  - restore_cache:
      keys:
        - deps-php-{{ arch }}-{{ checksum "composer.lock" }}
        - deps-php-{{ arch }}-
  - run:
      name: Init
      command: make composer mkdirs
  - run:
      name: Patchy
      command: <<include(scripts/patchy.sh)>>
